# パフォーマンス測定レポート（GET /timeline）

本ドキュメントは、筋トレ日記アプリにおけるタイムライン取得 API
`GET /timeline` のパフォーマンスを **ローカル環境** と **デプロイ環境**
の両方で測定し、性能分析およびボトルネックの有無を評価する目的で作成

---

## 1. 測定対象 API

### `GET /timeline`

選定理由：
- DBアクセス（JOIN／ユーザー・投稿・種目 関係取得）を含む

---

## 2. 測定環境

| 項目 | ローカル環境 | デプロイ環境 |
|------|--------------|--------------|
| 稼働環境 | Docker (Mac) | GCP（デプロイ済み Go API） |
| DB | PostgreSQL（local docker） | Neon |
| 通信経路 | localhost | インターネット越し |

### データ量（現状仕様）

| データ | 件数 |
|--------|------|
| 投稿件数 | 約10件 |
| いいね件数 | 未集計（いいね済みフラグのみを返却） |

※本APIでは `like_count` を返却しないため、  
レスポンスサイズは小さく、集計コストも低い。  
本測定では SELECT + JOIN + JSON エンコード処理を主な対象とする。

---

## 3. 測定方法

### 使用コマンド

```bash
curl -w "%{time_total}\n" \
  -H "Authorization: Bearer <TOKEN>" \
  -o /dev/null -s \
  http://localhost:8080/timeline

curl -w "%{time_total}\n" \
  -H "Authorization: Bearer <TOKEN>" \
  -o /dev/null -s \
  https://muscle-diary-backend-259090965328.asia-northeast1.run.app/timeline
```

### 測定条件

3回計測し平均値を算出
同一端末から実行
キャッシュなし

---


## 4. 測定結果

### ローカル環境(レコード数15件)
|  実行回数                   | time_total(秒)          |   ミリ秒換算  |
| --------------- | ------------- |-------------------|
| 1回目               | 0.003574    |  約 3.57 ms   |
| 2回目       | 0.003222   |   約 3.22 ms     |
|  3回目          |  0.004178 |   約 4.18 ms   |

平均値： 約 0.003658 秒（約 3.66 ms）

### デプロイ環境(レコード数15件)
| 実行回数 | time_total(秒) | ミリ秒換算 |
|----------|----------------|------------|
| 1回目 | 0.251107 | 約 251 ms |
| 2回目 | 0.342282 | 約 342 ms |
| 3回目 | 0.329097 | 約 329 ms |

平均値： 約 0.307495 秒（約 307 ms）
---

## 5. 分析

### ローカル環境
- 全リクエストが 3〜4ms台と非常に高速

### デプロイ環境
- 250〜340ms 程度で安定
- 300ms 前後は Web API として UX 上許容範囲
    - 多くの文献やガイドラインで、APIの一般的な許容範囲は100〜500ms
    - 今回はその範囲内に収まっている

---

## 6. ボトルネック判断
### ローカル環境
- 現状のデータ量（15件）の場合、ローカル環境での /timeline は3〜4msで応答しており、ボトルネックは存在しないと判断する。

### デプロイ環境
- 応答速度が 250〜340ms と UX観点では許容範囲たためボトルネックは存在しないと判断する。
- 今後データ量が増加した場合にはページネーション導入で対応可能。
